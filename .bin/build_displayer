#!/bin/bash

set -e

cd `dirname "$0"`
cd ../displayer

# Run type checks (vite doesn't)
./node_modules/.bin/tsc --noEmit

# NOTE Ensures all synchronous assets inlined so ready when app loads
# WARN Passing an empty string '' as an arg converts to 0 for some reason
./node_modules/.bin/vite build --assetsInlineLimit 99999 --assetsDir 'assets' --base './'

# Tar index and assets and place in app
# WARN Be sure to avoid including a dev dir in the tar
cd dist
tar --create --file ../../app/src/assets/displayer.tar index.html assets
